\ProvidesPackage{prodrive/package/pdfunction}
\RequirePackage{etoolbox}
\RequirePackage{tabularx}
\RequirePackage{listings}
\RequirePackage{color, colortbl}
\RequirePackage{caption}

% TODO: handing indent for multiline argin, argout and return
% TODO: syntax highlighting
% Input arguments
\newcommand{\pdfunctionargin}[2]
{%
  \ifnumequal{\value{pdfunctionargincount}}{0}
    {\item[Input: ] \texttt{\detokenize\expandafter{#1}}: #2~}
    {\item[~]       \texttt{\detokenize\expandafter{#1}}: #2~}
  \stepcounter{pdfunctionargincount}
}

% Output arguments
\newcommand{\pdfunctionargout}[2]
{%
  \ifnumequal{\value{pdfunctionargoutcount}}{0}
    {\item[Output:] \texttt{\detokenize\expandafter{#1}}: #2~}
    {\item[~]       \texttt{\detokenize\expandafter{#1}}: #2~}
  \stepcounter{pdfunctionargoutcount}
}

% Return values
\newcommand{\pdfunctionreturn}[4]
{%
  \ifnumequal{\value{pdfunctionreturncount}}{0}
    {\item[Return:{\quad\texttt{\detokenize\expandafter{#1}}{#2}}] \ifstrempty{#3}{#4}{\texttt{\detokenize\expandafter{#3}}: #4~}}
    {\item[~]       \ifstrempty{#3}{#4}{\texttt{\detokenize\expandafter{#3}}: #4~}}
  \stepcounter{pdfunctionreturncount}
}

% Throws
\newcommand{\pdfunctionthrow}[2]
{%
  \ifnumequal{\value{pdfunctionthrowcount}}{0}
    {\item[Throw:]  \ifstrempty{#1}{#2}{\texttt{\detokenize\expandafter{#1}}: #2~}}
    {\item[~]       \ifstrempty{#1}{#2}{\texttt{\detokenize\expandafter{#1}}: #2~}}
  \stepcounter{pdfunctionthrowcount}
}

% Run errors
\newcommand{\pdfunctionrunerror}[2]
{%
  \ifnumequal{\value{pdfunctionrunerrorcount}}{0}
    {\item[Run error:] \ifstrempty{#1}{#2}{\texttt{\detokenize\expandafter{#1}}: #2~}}
    {\item[~]          \ifstrempty{#1}{#2}{\texttt{\detokenize\expandafter{#1}}: #2~}}
  \stepcounter{pdfunctionrunerrorcount}
}

% Completes
\newcommand{\pdfunctioncomplete}[2]
{%
  \ifnumequal{\value{pdfunctioncompletecount}}{0}
    {\item[Complete:] \ifstrempty{#1}{#2}{\texttt{\detokenize\expandafter{#1}}: #2~}}
    {\item[~]         \ifstrempty{#1}{#2}{\texttt{\detokenize\expandafter{#1}}: #2~}}
  \stepcounter{pdfunctioncompletecount}
}
\newcounter{pdfunctionargincount}
\newcounter{pdfunctionargoutcount}
\newcounter{pdfunctionreturncount}
\newcounter{pdfunctionthrowcount}
\newcounter{pdfunctionrunerrorcount}
\newcounter{pdfunctioncompletecount}

% Ensure the inline listing used to display the function is of the same size as the rest of the normal text.
\makeatletter
\lst@AddToHook{TextStyle}{\let\lst@basicstyle\normalsize}
\makeatother

\newenvironment{pdfunction}[2]
{
  \setcounter{pdfunctionargincount}{0}
  \setcounter{pdfunctionargoutcount}{0}
  \setcounter{pdfunctionreturncount}{0}
  \setcounter{pdfunctionthrowcount}{0}
  \setcounter{pdfunctionrunerrorcount}{0}
  \setcounter{pdfunctioncompletecount}{0}

  \lstinline$#1$
  \begin{description}[leftmargin=2.2cm,noitemsep,topsep=0pt,font=\normalfont,style=nextline,labelindent=0.4cm]
  \item[Descrip.:] #2

}
{
  \end{description}
  \vspace{1ex}
}
